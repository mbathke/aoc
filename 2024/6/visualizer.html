<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Day 6</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>
  <style>
    .labMap {
        display: flex;
        justify-content: space-evenly;
        flex-direction: column;
    }

    .row {
        display: flex;
        flex-direction: row;
    }
    
    .col {
        width: 30px;
        border: 1px solid silver;
        align-items: center;
        text-align: center;
    }

    .start {
        margin-top: 1rem;
        border: 1px solid lightblue;
        background-color: lightblue;
        color: black;
        border-radius: 5px;
        cursor: pointer;
        width: 300px;
        height: 50px;
    }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
  const input = `....#.......#.............#..##...................#..#..#..................................#....#.................................
................................#..#.............##.....#....#....................#.............................................#.
.#....#.........................................................................................#.#...............................
.......#.......#..................#........#..................................#...............#...........#.......................
..#......................#.....#...........#..........................................................................#...........
.#.............#.............#....#...............#..#................................................#..........#................
.#............................................#........#........................................#...............................#.
...............#...........#....#............................................#.......#...................................#........
.#.........................#................#.........#..##.....#........................................#........................
.........#...#......#..................#...........................................................#...#..............#...........
..................#..#....................#...................#.....................#......#....#...........#..#.........#........
.........................................................................................#..........#.............................
...........#...........#.....#..................#....................#............................................................
........#...........................................#............#...........................#.........................#..........
....##....##..............................#.................................................................#....#....#.......#...
..#............#.........##....................................................#.....................#.....................#......
......#.......#.##.......##...........................................#........#................#.................................
..#...#.........................................#....................#.....#........#....#......#......#................#.........
.#...................##............................................................#....................#.......................#.
......#....#.....#............#............#.................................................#..#.......#..........#..............
...............#....#.........#.............................................................................................#.....
...........#..........................#..............................................#.........#...............#..#..............#
...........#...#.................#........................................#...................#....#..............................
........#................................#...........................................................#.......#....................
...........#....................#.....#.........................................................#..............#....#...#.........
..........#........................................................#..............#..............................#................
..............................##...........................................#.....................................................#
...#..#........................................................................................................#........#.....##..
.......#........#........#.#.....................#................................................#.......................#...#...
...............#.......................................................................#.........#......#.#.##....................
......#..................#.....#..................#..#..................#.................#..#.....#...................#....#.....
.....#........#.............#....#...............................#.................#..............................................
....................................................#.......#......................................#....#.........................
...#.............#...............#.............#......#.#..............#......#.............#.....................................
..............#..................#............................................#..#.........................#......................
.............#............#........#........................................#.....................................................
...#.........#.............#.........#............#..........................................#................#...#...............
...........#.................#...................................................................#................................
...#..............................................................................................................#...............
..........#...............#...#......#...............##..............................................#....#...................#...
.........................................#...................................................#..#.....................#...........
......#..#.........#....................................#....................#..........#......#..................................
........#.........................................#................#.#.......#.......................#............#..............#
..........................#...............#....................#.............................#..............#.....................
..........................#...........#............................................#....#...#.....................................
...........#........#..........#..............................................................#...##......#.......#......#........
....#..........#...#...................##..........#.........................................#....#...............................
...............................................................#................................................#..........#......
................................................................................................................#.....#...........
...#.....................#......................................................................#....................#............
......................##...........#.......#.......#.......................................#......................................
......#......#........#....................................................................................#......................
.......#......................#.........................................................#.......#.................................
...............#..........#...#.#..........#.....#..............##.......#.....#....................................#.............
.......##....................................................................................#.#...#..........................#...
......#.............#.#.........................#....#......#......#...............#.........#..#.................................
.........................#........#.........................#....#..................#.................#............#......#.#.....
............#............#......................#.#................##........#....................................................
......#..............................#...........#.......#........#.................#.............................................
............................................#.....................................................#.................#...#.........
.................#.......................................#..................##...#..............................#......#.......#..
.#..#................#.#......................................#..........#..........#...........................#.......#.........
.........................................................................#.....##.............................#.............#.....
.#.......................#.....................#....##....#........................................#..............................
......#...........................................##..........#......#.........................#..#..........#....#...#...........
........#.#....................................................................................#..................................
..........#..............................#.....#......#.........#............................#........................#...........
....................#................................................................#...............................#........#...
....................................#.......#...................................##.........................#......................
.....................#.....................................#.........#..........................#.................................
.......#.................................#.....................#........................................#....................#....
......................................................................#.....#........................#.......................#....
..#............................#..................#...#.........#..........#..#.........................................#.#.......
....#............................................................................#.............................#..#.....#.........
......#..................................#.............................................................................#.........#
....#......................................................................#................#.....#...........................#...
.............#.........................#.#....................#........................#......................................#...
....#......................................................................#...#..................#..........#....#...............
.......#....#.#..#..#....#........#.....................................................#..................#..#...................
#..............#....................................#.......................................#.....................#...........#...
#.........#....#..#.........#.................#..................#.#..............................##......................#.......
................#.........#......................................................................................................#
...............................#.........#.................................................................#.....#.#..............
..........#................#.............................#.............#.......#..........................................#.......
.....#.........#........#..............#.......................................#.........^........................................
........................#................#........#.......................................#............................#...#......
......#.....#.......#.................................................#...............#.....#.....................................
..................................................#......#.....................................#....#....#.##....................#
.........................................................................#...#..............#...............#.....................
..........#.................#...................#.........................................................................#....#..
...........#.....................#.....#.......................................#....................#............#........#.......
......................#...........#........................................................................................#......
..........#.......#.................................................................................#.......#.....................
........#.....................................#..................................................##...............................
.......#................................#.........#..#..................................................................#.........
...........#...................##.............#...............................#..........#....................#.....#...#.........
....................................##..#..........................................#..............................................
...............#..#............#..............................#.#.#........#......#...............................................
..#..................................#....#.......................................................................................
........................#.................##.........#......................#........................#.#.#........................
.......................................#.##....................................................................#..................
..................................##............#..............................................................................#..
..#.................................................#.....................................................................#.......
................#..#..#...#.........#...#.................................................................#.....................##
.....#......................#...........#.............#...........................................................................
........#.....................#..............................................#................#..............................#....
........#.............#.........................#.............................................#................#..........#......#
#........#...................................#....#......#...............................#........................................
...........#........#..................................................#.............#..........................#.............#...
....................#..#.#.................................................#.#...........#................................#.#.....
.......................#...................................................#....................................................#.
......#......................................#..........##.......................#...........#.........#..........................
.......#..................#..................#......................#............................#.............#...#..............
.....................................................................................#........#................#.........#........
............................#..............................................................#.....#........#......#................
..#..........................#.........#.................#...........#...#....#........................#.......#.............#....
.#.....#.....#.....................#........#...............#............#.##........#..................................#.........
............#.#..................................#..#.........#.................#............................#........#.....#.....
............#.........................#..................................#........................................................
....................#................#...........#..........................................................................#.....
....................#.....................................................#.........#......#...........#...#.#..................#.
........#..........#.......................................#...............#....#............#.....................#..............
.......#...#......#...................#.......#..........................#.........................#...................#..........
.#............#....###...............###................................#.............................#...........................
.............................#.......#..............................#.#.........................................#..#..............
...............#.........#...................#...................................#..#..................#..........................
........#.......#..#..................#........................................................................#...............#..
.#.............#.....................#........#..........................#.........#..........................#...........#.......
.....#.............#.....#..........#.....#.............#............#.............................#..........................#...
...................#.......................#......#.#..............#..###.....#......................#...........#.......#.#......`

  function App() {
    const [state, setState] = React.useState(() => {
        const labMap = input.split('\n').map(row => row.split(''))
        let guard = {
            x: 0,
            y: 0,
            direction: 'up',
        };

        for (let y = 0; y < labMap.length; y++) {
            for (let x = 0; x < labMap[y].length; x++) {
                if (labMap[y][x] === '^') {
                    guard.x = x;
                    guard.y = y;
                }
            }
        }

        return {
            labMap,
            guard,
        }
    })

    const visited = React.useMemo(() => {
        const {labMap} = state

        return labMap.flat().filter(field => field === 'X').length
    }, [state])

    const startAction = () => {
        setState((prevState) => {
            const {labMap, guard} = prevState

            if (
                guard.y < 0 || guard.y >= labMap.length || 
                guard.x < 0 || guard.x >= labMap[guard.y].length
            ) {
                console.log('End reached')
                return prevState
            }

            switch(guard.direction) {
                case 'up': 
                    if (guard.y - 1 >= 0 && labMap[guard.y - 1][guard.x] === '#') {
                        guard.direction = 'right'
                        labMap[guard.y][guard.x] = '>'
                        break;
                    }
                    labMap[guard.y][guard.x] = 'X'
                    guard.y -= 1;
                    if (guard.y >= 0) {
                        labMap[guard.y][guard.x] = '^'
                    }
                    break;
                case 'right': 
                    if (guard.x + 1 < labMap[guard.y].length && labMap[guard.y][guard.x + 1] === '#') {
                        guard.direction = 'down'
                        labMap[guard.y][guard.x] = 'v'
                        break;
                    }
                    labMap[guard.y][guard.x] = 'X'
                    guard.x += 1;
                    if (guard.x < labMap[guard.y].length) {
                        labMap[guard.y][guard.x] = '>'
                    }
                    break;
                case 'down': 
                    if (guard.y + 1 < labMap.length && labMap[guard.y + 1][guard.x] === '#') {
                        guard.direction = 'left'
                        labMap[guard.y][guard.x] = '<'
                        break;
                    }
                    labMap[guard.y][guard.x] = 'X'
                    guard.y += 1;
                    if (guard.y < labMap.length) {
                        labMap[guard.y][guard.x] = 'v'
                    }
                    break;
                case 'left': 
                    if (guard.x - 1 >= 0 && labMap[guard.y][guard.x - 1] === '#') {
                        guard.direction = 'up'
                        labMap[guard.y][guard.x] = '^'
                        break;
                    }
                    labMap[guard.y][guard.x] = 'X'
                    guard.x -= 1;
                    if (guard.x >= 0) {
                        labMap[guard.y][guard.x] = '<'
                    }
                    break;
                default: 
                    // do nothing
            }

            return {
                labMap,
                guard,
            }
        })
    }

    React.useEffect(() => {
        const interval = setInterval(startAction, 1)
        return () => clearInterval(interval)
    }, [])

    return (
        <div>
            <div className="labMap">
                {state.labMap.map((row, y) => ( 
                    <div key={y} className="row">
                        {row.map((col, x) => (
                            <span key={x} className="col">{col}</span>
                        ))}
                    </div>
                ))}
            </div>

            <button type="button" className="start" onClick={startAction}>Start guarding</button>
            <div>Visited fields: {visited}</div>
        </div>
    )
  }

  const root = ReactDOM.createRoot(document.querySelector('#root'))
  root.render(<App/>)
</script>
</body>
</html>
